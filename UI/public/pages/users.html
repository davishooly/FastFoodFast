<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fast-Food-Fast</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href=" https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900 " rel="stylesheet ">
    <link rel="stylesheet" type="text/css" media="screen" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="../css/grid.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="../css/meals.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="../css/media-queries.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="../css/dashboard.css" />
</head>

<body>
    <header>
        <nav>
            <div class="main-nav">
                <svg class="icon shopping-cart">
                    <use xlink:href="../images/symbol-defs.svg#icon-shopping-cart"></use>
                </svg>
            </div>
            <div class="main-nav left">
                <li>
                    <a href="../index.html ">Home</a>
                </li>
            </div>
            <div class="main-nav">
                <li>
                    <a href="order-history.html">order history</a>
                </li>
            </div>
        </nav>
    </header>
    <section class="top-menu">

    </section>
    <section class="user">

        <!-- create a modal -->
        <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="close" onclick="closing()">&times;</span>
                <p class="location">
                    Tell us where you are
                </p>
                <form action="" class="place">
                    <input list="cities" class="enter" placeholder="Choose town">
                    <datalist id="cities">
                        <option value="Nairobi">
                        <option value="Kisumu">
                        <option value="Mombasa">
                        <option value="Nakuru">
                        <option value="Eldoret">
                    </datalist>
                    <input type="submit" class="btn btn-add-order btn-animated" id="place-order" value="Add to order">
                </form>
            </div>
        </div>
        <div class="menu-big">
            Menu of the day
        </div>
        <div class="checkout">
            <div class="from">

                <p class="me">
                    DESTINATION
                </p>
                <p class="dest">
                    Location
                </p>
            </div>
            <div class="from">
                <p class="me orders"> your cat is empty start adding your favourite meals</p>
            </div>

            <div>
                <form action="" class="order">
                    <svg class="icon icon-shopping-cart">
                        <use xlink:href="../images/symbol-defs.svg#icon-shopping-cart"></use>

                    </svg>
                    <input type="submit" class="btn btn-order btn-animated" id="place-order" value="proceed to checkout">

                </form>
                <div class="from">
                    <p class="log-out dest"></p>
                </div>
            </div>

        </div>
        <ul class="meals-user">
            <!-- <li>
                <div class="align well">
                    <div class="column-left">
                        <figure class="image-meals ">
                            <img src="../images/f3.jpg" alt="egg ">
                        </figure>
                    </div>
                    <div class="column-left">
                        <div class="margintop">
                            <p class="new-account-small">Price. 450ksh</p>
                            <p class="new-account-small">rice served with heavy stew made from mushroom soup with
                                boiled peace and row carrots blended in..Served with juice</p>
                            <input type="submit" class="btn btn-blue btn-animated" value="place order">
                        </div>
                    </div>
                </div> -->

            </li>
        </ul>
    </section>


    <footer id="contacts">
        <div class="row-two">
            <div class="col span-1-of-2">
                <ul class="footer-nav">
                    <li>
                        <a href="#">About us</a>

                    </li>
                    <li>
                        <a href="#">Our locations</a>
                    </li>
                    <li>
                        <div>
                            <a href="#">Terms of service</a>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="col span-1-of-2">
                <ul class="social-icons">

            </div>
        </div>
        <div class="row-two">
            <p>Copyright &copy;2018 by Kimame. All rights reserved.</p>
        </div>
    </footer>
</body>
<script src="../dist/user_menu.bundle.js"></script>

<script>

    let mode = document.querySelector("#myModal");

    let span = document.querySelector(".close")[0];

    const order = document.querySelector(".place");

    const place = document.querySelector(".order");

    const foods = JSON.parse(window.localStorage.getItem("food"));


    const destination = [];
    const orders_made = [];

    order.addEventListener("submit", event => {
        event.preventDefault();
        const place = document.querySelector(".enter").value;
        destination.push(place);

        if (place) {
            document.querySelector(".dest").innerHTML = `${place}`;
        }
        setTimeout(() => {
            mode.style.display = "none";
        }, 1000);

        if (orders_made.length >= 1) {
            document.querySelector(".orders").innerHTML = `you have ${orders_made.length} order`;
        }
    })
    function add_to_cat(id) {
        mode.style.display = "block";

        for (let food of foods) {
            if (food["id"] === id) {
                orders_made.push(food);
            }
        }
    }
    function closing() {
        mode.style.display = "none";
    }
    place.addEventListener("submit", event => {
        event.preventDefault();
        let id = orders_made[0].id
        let token = window.localStorage.getItem("token");

        fetch(`https://fasty-v2.herokuapp.com/api/v2/users/${id}/orders`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`
            },
            body: JSON.stringify({
                destination: destination[0],
                Quantity: orders_made.length
            })
        })
            .then(data => data.json())
            .then(data => {

                let message = data.msg;
                // console.log(message)

                if (message === "Token has expired") {
                    document.getElementById("place-order").addEventListener('click', function () {
                        textContent = "pldddd";
                    });
                    document.querySelector(".log-out").innerHTML = `Please login to proceed, <a class="forgot-pass" href="./login.html">Login</a>`;
                }

            })
    })
    function login() {
        alert("please login to place order")

    }
</script>

</html>