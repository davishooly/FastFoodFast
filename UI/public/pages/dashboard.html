<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fast-Food-Fast</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" media="screen" href="../css/dashboard.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../css/history.css">
    <link href=" https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900 " rel="stylesheet ">
    <link rel="stylesheet" media="screen" href="../css/shared.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../css/media-queries.css" />

</head>

<body>
    <div class="dashboard">
        <aside>
            <div class="navigation">
                <h1 class="nav__heading">Admin Dashboard</h1>
                <a class=" navs" href="../index.html">
                    Home
                </a>
                <a class=" navs" href="add-food.html">
                    Add food item
                </a>
                <a class=" navs" href="food-menu-admin.html">
                    View added food
                </a>
                <a class="food__items navs" href="dashboard.html"> views all orders</a>
                <a class=" navs" href="orders.html">
                    Accepted orders
                </a>
                <a class=" navs" href="#">
                    Log Out
                </a>
                <div class="copyright">
                    Copyright &copy;2018 by Kimame.
                    <p>All rights reserved.</p>
                </div>
            </div>
        </aside>
        <main>
            <header>
                <nav>
                    <div class="main-nav">
                        <ul>
                            <li>
                                <i class="fa fa-search"></i>
                            </li>
                            <li>
                                <i class="fa fa-flag"></i>
                            </li>

                            <li>
                                <i class="fa fa-user-circle"></i>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>

            <section class="dashboard__content">
                <div class="history__container ">
                    <div class="order-history">
                        <p>Customers orders</p>
                    </div>
                    <div class="all">
                        <div class="rows">
                            <div class="history__item desc_header">Meal orders</div>
                            <div class="history__item desc_header">food</div>
                            <div class="history__item desc_header">quantity</div>
                            <div class="history__item desc_header ">Date</div>
                            <div class="history__item desc_header ">Delivery location</div>
                            <div class="history__item desc_header ">ordered by</div>
                            <div class="history__item desc_header ">status</div>
                            <div class="history__item desc_header ">Accept/reject</div>
                        </div>
                    </div>
                </div>
                <div class="pagination">

                </div>
            </section>
        </main>
    </div>
</body>
<script src="../dist/all_orders.bundle.js"></script>
<script>
    let token = window.localStorage.getItem("token");
    let orders = JSON.parse(window.localStorage.getItem("orders"))
    let order_container = document.querySelector(".all");

    function accept_order(id) {
        let c = confirm("confirm accept order")
        if (c) {
            fetch(`https://fasty-v2.herokuapp.com/api/v2/orders/${id}/accept`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`
                    }
                }).then(data => data.json())
                .then(data => {
                    let message = data.message;

                    if (message === "order accepted sucessfully") {
                        setTimeout(() => {
                                location.reload();
                            },
                            100)
                    }
                })
        }
    }

    function decline_order(id) {
        let c = confirm("confirm decline order")
        if (c) {
            fetch(`https://fasty-v2.herokuapp.com/api/v2/orders/${id}/reject`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`
                    }
                }).then(data => data.json())
                .then(data => {
                    let message = data.messge;
                    console.log(data);
                    if (message === "order rejected sucessfully") {
                        setTimeout(() => {
                                location.reload();
                            },
                            100)
                    }
                })
        }
    }

    function getPage(max) {
        let maxitem = max * 10;
        let min_item = maxitem - 10;
        document.querySelector(".all").innerHTML = "";

        for (let i = min_item; i < maxitem; i++) {
            const order =
                `
                <div class="rows">
                <div class="history__item desc_header">${orders[i].id}</div>
                <div class="history__item desc_header">${orders[i].name}</div>
                <div class="history__item desc_header">${orders[i].Quanity}</div>
                <div class="history__item desc_header ">${orders[i].date.split(" ")[0]}</div>
                <div class="history__item desc_header ">${orders[i].destination}</div>
                <div class="history__item desc_header ">${orders[i].orderd_by}</div>
                <div class="history__item desc_header ">${orders[i].status}</div>
                <div class="history__item">
                <div class="accept_order">
                <i class="fa fa-check-circle btn-accept" onclick="accept_order(${orders[i].id})"></i>
                <i class="fa fa-times-circle btn-reject" onclick="decline_order(${orders[i].id})"></i>
               </div>
               </div>
                `;
            order_container.insertAdjacentHTML("beforeend", order);
        }
    }
</script>

</html>